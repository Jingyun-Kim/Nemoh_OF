#!/usr/bin/python2.7
# -*- coding: utf-8 -*-
#--------------------------------------------------------------------------------------
#
#   NEMOH2 - second order (QTF) - November 2014
#   Contributors list:
#   - Fabien Robaux (EDF/INNOSEA)
#   - Adrien Combourieu, INNOSEA (adrien.combourieu@innosea.fr)
#   - Jean-Noel Dory (jeannoel.dory@gmail.com) (JND)
#   Created on Fri May 16 09:04:22 2014
#   update JND 09/2015
#--------------------------------------------------------------------------------------

import numpy as np
import math

""" Résultats tabulés de Kim & Yue pour les QTF + et - pour les 4
cas tests de référence. 
Source : The complete second-order diffraction solution for an axisymmetric body Part2, 30 May 1989, Kim & Yue
"""


def Tab_Kim_Yue(dof, choix, shape, qtftype):

    #B=np.array([0.8,1.0,1.2,1.4,1.6,1.8,2.0])
    TAB=[]
    if qtftype == '-':
        if shape=='msphere':
            B=np.array([0.8,1.0,1.2,1.4,1.6,1.8,2.0])
            if choix=='hasfs':
                if dof==1:
                    A=np.array([[0,0.038,0.062,0.103,0.158,0.215,0.269],
                                [0.,0.028,0.072,0.129,0.189,0.247],
                                [0.,0.020,0.060,0.109,0.160],
                                [0.,0.015,0.047,0.087],
                                [0.,0.013,0.042],
                                [0.,0.013],
                                [0.]])                 
                elif dof==3:
                    A=np.array([[0.],
                                [0.025,0.],
                                [0.046,0.023,0.],
                                [0.042,0.039,0.015,0.],
                                [0.065,0.061,0.040,0.012,0.],
                                [0.111,0.098,0.077,0.039,0.011,0.],
                                [0.171,0.150,0.126,0.080,0.041,0.012,0.],
                                ])               
                else:
                    print 'dof non table'
            elif choix=='duok':
                if dof==1:
                    A=np.array([[0.071,0.398,0.522,0.411,0.359,0.352,0.358],
                                [0.519,0.719,0.619,0.534,0.482,0.447],
                                [0.878,0.783,0.718,0.681,0.653],
                                [0.717,0.677,0.660,0.648],
                                [0.652,0.645,0.639],
                                [0.644,0.643],
                                [0.646]]) 
                    
                if dof==3:
                    A=np.array([[0.669],
                                [0.568,0.306],
                                [0.135,0.189,0.494],
                                [0.121,0.376,0.526,0.488],
                                [0.204,0.430,0.516,0.457,0.426],
                                [0.241,0.447,0.499,0.434,0.407,0.392],
                                [0.259,0.448,0.476,0.409,0.386,0.378,0.370],
                                ])
            elif choix=='hasbo':
                
                if dof==1:
                    A=np.array([[0,0.018,0.053,0.072,0.091,0.115,0.147],
                                [0,0.015,0.026,0.040,0.060,0.084],
                                [0,0.004,0.010,0.020,0.036],
                                [0,0.005,0.010,0.019],
                                [0,0.003,0.008],
                                [0,0.002],
                                [0],
                                ])
                if dof==3:
                    A=np.array([[0],
                                [0.032,0],
                                [0.081,0.030,0],
                                [0.107,0.063,0.018,0],
                                [0.13,0.090,0.040,0.014,0],
                                [0.154,0.113,0.060,0.028,0.012,0],
                                [0.177,0.134,0.077,0.043,0.023,0.010,0],
                                ])
            elif choix=='tot':
                if dof==1:
                    A=np.array([[0.071,0.372,0.475,0.351,0.266,0.217,0.196],
                                [0.519,0.709,0.591,0.483,0.407,0.354],
                                [0.878,0.766,0.660,0.570,0.487],
                                [0.717,0.658,0.598,0.529],
                                [0.652,0.627,0.581],
                                [0.644,0.626],
                                [0.646],
                                ])
                elif dof==3:
                    A=np.array([[0.669],
                                [0.270,0.306],
                                [0.213,0.469,0.494],
                                [0.320,0.630,0.817,0.488],
                                [0.369,0.681,0.820,0.742,0.426],
                                [0.387,0.694,0.813,0.730,0.686,0.392],
                                [0.383,0.680,0.788,0.713,0.676,0.655,0.370],
                                ])
                else:
                    print'dof non table'        
            else:
                print 'choix non existant (duok/hasbo/tot/hasfs)'

        elif shape=='cyl40':
            B=np.array([1.0,1.2,1.4,1.6,1.8,2.0])
            if choix=='hasfs':
                if dof==1:
                    A=np.array([[0.],
                                [0.034,0.],
                                [0.088,0.034,0.],
                                [0.150,0.093,0.035,0.],
                                [0.208,0.158,0.096,0.037,0.],
                                [0.243,0.215,0.161,0.099,0.038,0.],
                                ])
                else:
                    print 'dof non table'
                
            elif choix=='duok':
                if dof==1:
                    A=np.array([[0.666],
                                [0.647,0.636],
                                [0.612,0.612,0.603],
                                [0.578,0.588,0.584,0.600],
                                [0.552,0.567,0.583,0.602,0.615],
                                [0.534,0.547,0.566,0.593,0.615,0.624],
                                ])
                else:
                    print'dof non table'
                    
            elif choix=='hasbo':
                if dof==1:
                    A=np.array([[0.],
                                [0.167,0],
                                [0.331,0.165,0],
                                [0.481,0.325,0.164,0],
                                [0.602,0.471,0.322,0.163,0],
                                [0.676,0.586,0.463,0.319,0.162,0],
                                ])
                else:
                    print 'dof non table'
            elif choix=='tot':
                if dof==1:
                    A=np.array([[0.666],
                                [0.689,0.636],
                                [0.763,0.640,0.603],
                                [0.856,0.701,0.615,0.600],
                                [0.943,0.788,0.678,0.619,0.615],
                                [1.009,0.877,0.765,0.678,0.629,0.624],
                                ])
                                    
                else:
                    print 'choix non existant tot/duok/hasbo/hasfs'      

        elif shape=='cyl10':
            B=np.array([1.0,1.2,1.4,1.6,1.8,2.0])
            if choix=='hasfs':
                if dof==1:
                    A=np.array([[0.,0.037,0.097,0.166,0.229,0.273],
                                [0.,0.036,0.097,0.166,0.226],
                                [0.,0.036,0.099,0.166],
                                [0.,0.037,0.101],
                                [0.,0.038],
                                [0.],
                                ])
                else:
                    print 'dof non table'
            elif choix=='duok':
                if dof==1:
                    A=np.array([[0.918,0.846,0.811,0.765,0.722,0.680],
                                [0.826,0.791,0.758,0.723,0.685],
                                [0.772,0.753,0.729,0.698],
                                [0.748,0.735,0.712],
                                [0.732,0.717],
                                [0.711],
                                ])
                elif dof==5:
                    A=np.array([[0.003,0.063,0.115,0.155,0.185,0.207],
                                [0.044,0.080,0.120,0.154,0.182],
                                [0.076,0.099,0.128,0.157],
                                [0.96,0.111,0.134],
                                [0.106,0.117],
                                [0.112],
                                ])
                    
                else:
                    print 'dof non table'
            elif choix=='hasbo':
                if dof==1:
                    A=np.array([[0.,0.302,0.568,0.794,0.966,1.063],
                                [0.,0.259,0.493,0.697,0.854],
                                [0.,0.231,0.445,0.632],
                                [0.,0.213,0.411],
                                [0.,0.200],
                                [0.],
                                ])
                else:
                    print 'dof non table'
            elif choix=='tot':
                if dof==1:
                    A=np.array([[0.918,0.982,1.163,1.347,1.489,1.575],
                                [0.826,0.870,1.011,1.165,1.294],
                                [0.772,0.810,0.925,1.054],
                                [0.748,0.777,0.867],
                                [0.732,0.749],
                                [0.711],
                                ])
                elif dof==5:
                    A=np.array([[0.003,0.345,0.624,0.848,1.016,1.126],
                                [0.044,303,0.548,0.750,0.908],
                                [0.076,0.281,0.500,0.687],
                                [0.096,0.267,0.469],
                                [0.106,0.259],
                                [0.112],
                                ])
                else:
                    print 'dof non table'
            else:
                print 'choix non existant tot/duok/hasbo/hasfs'

        elif shape=='fsphere':
            B=np.array([0.8,1.0,1.2,1.4,1.6,1.8,2.0])
            if dof==1:
                if choix=='hasfs':
                    A=np.array([[0.,0.015,0.039,0.071,0.105,0.137,0.156],
                                [0.,0.014,0.038,0.070,0.104,0.132],
                                [0.,0.013,0.038,0.069,0.102],
                                [0.,0.013,0.037,0.069],
                                [0.,0.012,0.037],
                                [0.,0.012],
                                [0.]])
                elif choix=='duok':
                    A=np.array([[0.375,0.427,0.454,0.461,0.461,0.461,0.462],
                                [0.471,0.493,0.498,0.497,0.495,0.494],
                                [0.513,0.517,0.516,0.515,0.513],
                                [0.523,0.525,0.526,0.525],
                                [0.531,0.536,0.538],
                                [0.545,0.551],
                                [0.560]])
                elif choix=='tot':
                    A=np.array([[0.375,0.416,0.418,0.389,0.346,0.302,0.267],
                                [0.471,0.482,0.459,0.415,0.360,0.304],
                                [0.513,0.505,0.472,0.422,0.362],
                                [0.523,0.511,0.478,0.428],
                                [0.531,0.522,0.489],
                                [0.545,0.536],
                                [0.560]])                
                elif choix=='hasbo':
                    A=np.array([[0.,0.063,0.144,0.253,0.381,0.513,0.627],
                                [0.,0.061,0.140,0.246,0.369,0.495],
                                [0.,0.060,0.138,0.241,0.362],
                                [0.,0.059,0.136,0.238],
                                [0.,0.059,0.135],
                                [0.,0.058],
                                [0.]])
                
                else:
                    print 'choix non existant tot/duok/hasbo/hasfs'     
            elif dof==3:
                if choix=='hasfs':
                    A=np.array([[0.],
                                [0.010,0.],
                                [0.036,0.011,0.],
                                [0.076,0.040,0.012,0.],
                                [0.128,0.082,0.042,0.013,0.],
                                [0.191,0.137,0.087,0.044,0.013,0.],
                                [0.263,0.203,0.144,0.090,0.045,0.013,0.]])
                elif choix=='duok':
                    A=np.array([[0.510],
                                [0.484,0.538],
                                [0.445,0.512,0.499],
                                [0.402,0.478,0.477,0.468],
                                [0.358,0.440,0.449,0.450,0.442],
                                [0.315,0.398,0.414,0.424,0.425,0.417],
                                [0.274,0.356,0.376,0.392,0.401,0.401,0.392]])
                elif choix=='tot':
                    A=np.array([[0.510],
                                [0.792,0.538],
                                [0.749,0.803,0.499],
                                [0.702,0.770,0.760,0.468],
                                [0.647,0.731,0.734,0.728,0.442],
                                [0.583,0.681,0.701,0.706,0.701,0.417],
                                [0.516,0.621,0.655,0.676,0.681,0.675,0.392]])                
                elif choix=='hasbo':
                    A=np.array([[0.],
                                [0.298,0.],
                                [0.274,0.280,0.],
                                [0.248,0.258,0.272,0.],
                                [0.227,0.232,0.250,0.267,0.],
                                [0.238,0.211,0.222,0.245,0.264,0.],
                                [0.300,0.225,0.201,0.215,0.241,0.262,0.]])
                else:
                    print 'choix non existant tot/duok/hasbo'         
            else:
                print 'dof non table'   
        else:
            print 'shape non existante : msphere/fsphere/cyl10/cyl40'
    # QTF +++++++++     
    elif qtftype == '+':
        if shape=='msphere':
            B=np.array([1.0,1.2,1.4,1.6,1.8,2.0])
            if choix=='duok':
                if dof==1:
                    A=np.array([[2.646,2.551,2.107,1.916,1.797,1.677],
                                [2.871,2.548,2.373,2.263,2.151],
                                [2.302,2.154,2.061,1.965],
                                [2.010,1.916,1.823],
                                [1.822,1.735],
                                [1.665],
                                ]) 
                    
                if dof==3:
                    A=np.array([[3.467],
                                [2.702,2.085],
                                [1.539,1.200,0.720],
                                [0.962,0.771,0.496,0.378],
                                [0.656,0.553,0.393,0.330,0.307],
                                [0.473,0.431,0.340,0.306,0.295,0.284],
                                ])
            elif choix=='tot':
                print 'tot'
                if dof==1:
                    A=np.array([[1.041,0.977,0.812,0.733,0.678,0.632],
                                [1.067,0.948,0.879,0.822,0.761],
                                [0.857,0.806,0.760,0.705],
                                [0.778,0.759,0.694],
                                [0.752,0.766],
                                [0.829],
                                ])
                elif dof==3:
                    A=np.array([[1.461],
                                [1.877,2.338],
                                [1.517,1.866,1.516],
                                [1.280,1.632,1.372,1.383],
                                [1.159,1.375,1.305,1.451,1.653],
                                [1.051,1.278,1.254,1.450,1.734,1.918],
                                ])
                else:
                    print'dof non table'
            else:
                print 'choix non existant (duok/tot)'
    
        elif shape=='cyl10':
            B=np.array([1.0,1.2,1.4,1.6,1.8,2.0])
            if choix=='has':
                if dof==1:
                    A=np.array([[1.636,1.963,2.308,2.582,2.710,2.661],
                                [2.262,2.549,2.752,2.807,2.682],
                                [2.754,2.876,2.857,2.671],
                                [2.930,2.872,2.668],
                                [2.816,2.688],
                                [2.693],
                                ])
                elif dof==5:
                    A=np.array([[0.785,0.942,1.089,1.194,1.228,1.179],
                                [1.071,1.171,1.252,1.256,1.180],
                                [1.251,1.285,1.262,1.167],
                                [1.295,1.265,1.179],
                                [1.255,1.217],
                                [1.254],
                                ])
                else:
                    print 'dof non table'
            elif choix=='duok':
                if dof==1:
                    A=np.array([[1.440,1.577,1.709,1.802,1.828,1.778],
                                [1.676,1.764,1.813,1.797,1.709],
                                [1.805,1.808,1.753,1.634],
                                [1.772,1.689,1.556],
                                [1.593,1.467],
                                [1.368],
                                ])          
                elif dof==5:
                    A=np.array([[0.217,0.199,0.184,0.166,0.145,0.121],
                                [0.1814,0.164,0.147,0.126,0.103],
                                [0.147,0.130,0.109,0.086],
                                [0.112,0.094,0.073],
                                [0.078,0.063],
                                [0.058],
                                ])  
                else:
                    print 'dof non table'
            elif choix=='tot':
                if dof==1:
                    A=np.array([[0.939,0.782,0.778,0.850,0.903,0.886],
                                [0.752,0.847,0.959,1.013,0.973],
                                [0.971,1.074,1.105,1.037],
                                [1.160,1.184,1.114],
                                [1.226,1.227],
                                [1.334],
                                ])
                elif dof==5:
                    A=np.array([[0.635,0.794,0.939,1.048,1.094,1.063],
                                [0.927,1.039,1.117,1.136,1.079],
                                [1.116,1.162,1.156,1.082],
                                [1.185,1.173,1.106],
                                [1.178,1.155],
                                [1.198],
                                ])
                else:
                    print 'dof non table'
            else:
                print 'choix non existant tot/duok/has'
       
        elif shape=='cyl40':
            B=np.array([1.0,1.2,1.4,1.6,1.8,2.0])
            if choix=='has':
                if dof==1:
                    A=np.array([[3.004],
                                [3.179,3.723],
                                [3.408,4.035,4.472],
                                [3.685,4.211,4.654,4.975],
                                [3.769,4.162,4.454,4.843,5.097],
                                [3.613,3.852,3.961,4.159,4.695,5.043],
                                ])
                elif dof==5:
                    A=np.array([[4.472],
                                [4.220,4.934],
                                [3.762,4.777,5.237],
                                [3.481,4.333,5.079,5.580],
                                [3.088,3.739,4.332,5.231,6.037],
                                [2.569,3.008,3.351,3.983,5.421,6.502],
                                ])
                else:
                    print 'dof non table'
            elif choix=='duok':
                if dof==1:
                    A=np.array([[1.493],
                                [1.546,1.641],
                                [1.681,1.774,1.868],
                                [1.850,1.909,1.945,1.957],
                                [1.969,1.981,1.957,1.910,1.820],
                                [1.995,1.959,1.878,1.786,1.677,1.554],
                                ])
                elif dof==5:
                    A=np.array([[0.235],
                                [0.254,0.262],
                                [0.272,0.267,0.259],
                                [0.279,0.264,0.245,0.223],
                                [0.270,0.248,0.223,0.196,0.168],
                                [0.246,0.221,0.191,0.164,0.138,0.116],
                                ])
                else:
                    print'dof non table'
            elif choix=='tot':
                if dof==1:
                    A=np.array([[1.518],
                                [1.641,2.084],
                                [1.748,2.262,2.612],
                                [1.853,2.302,2.714,3.021],
                                [1.809,2.182,2.505,2.935,3.277],
                                [1.620,1.899,2.094,2.375,3.018,3.502],
                                ])
                elif dof==5:
                    A=np.array([[4.309],
                                [4.028,4.738],
                                [3.524,4.554,5.011],
                                [3.219,4.092,4.851,5.364],
                                [2.829,3.505,4.120,5.037,5.869],
                                [2.331,2.798,3.168,3.821,5.283,6.387],
                                ])
                else:
                    print'dof non table'            
            else:
                print 'choix non existant tot/duok/has'
        
        elif shape=='fsphere':
            B=np.array([1.0,1.2,1.4,1.6,1.8,2.0])
            
            if dof==1:
                if choix=='has':
                    A=np.array([[1.104,1.249,1.412,1.594,1.747,1.830],
                                [1.426,1.604,1.777,1.905,1.954],
                                [1.774,1.918,2.006,2.015],
                                [2.024,2.079,1.995],
                                [2.057,2.032],
                                [2.017],
                                ])
                elif choix=='duok':
                    A=np.array([[1.247,1.268,1.317,1.399,1.485,1.538],
                                [1.333,1.409,1.496,1.569,1.600],
                                [1.488,1.560,1.607,1.607],
                                [1.604,1.617,1.586],
                                [1.598,1.545],
                                [1.484],
                                ])
                elif choix=='tot':
                    A=np.array([[0.730,0.704,0.692,0.681,0.655,0.610],
                                [0.663,0.642,0.628,0.603,0.560],
                                [0.614,0.600,0.579,0.541],
                                [0.592,0.585,0.518],
                                [0.563,0.570],
                                [0.606],
                                ])                              
                else:
                    print 'choix non existant tot/duok/has'     
            elif dof==3:
                if choix=='has':
                    A=np.array([[1.229],
                                [1.192,1.182],
                                [1.055,1.055,0.937],
                                [0.909,0.968,0.859,0.874],
                                [0.816,0.812,0.836,0.971,1.187],
                                [0.759,0.789,0.859,1.055,1.342,1.572]])
                elif choix=='duok':
                    A=np.array([[0.320],
                                [0.278,0.237],
                                [0.230,0.191,0.147],
                                [0.187,0.151,0.114,0.094],
                                [0.157,0.126,0.100,0.096,0.108],
                                [0.139,0.116,0.102,0.107,0.122,0.133]])
                elif choix=='tot':
                    A=np.array([[0.914],
                                [0.918,0.948],
                                [0.827,0.865,0.790],
                                [0.722,0.819,0.745,0.781],
                                [0.660,0.687,0.736,0.877,1.083],
                                [0.620,0.673,0.758,0.951,1.225,1.444]])                
                else:
                    print 'choix non existant tot/duok/has'         
            else:
                print 'dof non table'
 
        else:
            print 'shape non existante : msphere/fsphere/cyl10/cyl40'
    else:
        print 'QTF type non existant : +/-'
    
    if len(A[0])>3:
        for i in range(len(B)):
            TAB.append([])        
            for j in range(len(B)):
                if j>=i:
                    TAB[i].append(A[i][j-i])
                elif j<i:
                    TAB[i].append(TAB[j][i])    
    else:
        for i in range(len(B)):
            TAB.append([])        
            for j in range(0,i+1):
                TAB[i].append(A[i][j])
            for j in range(i+1,len(B)):
                TAB[i].append(A[j][i])  
    
    if dof >= 4:
        WW=np.sqrt(B/10.0*9.81)
        TABKY=np.array(TAB)*1025.*9.81*10*10
    else:
        WW=np.sqrt(B/10.0*9.81)
        TABKY=np.array(TAB)*1025.*9.81*10
    
    return WW,TABKY


def geticontrib(shape):
  
  if shape=="cyl10" or shape=="cyl40":
    icontrib = 5
  if shape=="msphere":
    icontrib=3
  if shape=="fsphere":
    icontrib=6
      
  return icontrib
